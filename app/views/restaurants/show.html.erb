<html>
<head>


<title><%= @title %></title>

<%= stylesheet_link_tag "restaurantStyle", "http://fonts.googleapis.com/css?family=Lobster+Two", 
										"http://fonts.googleapis.com/css?family=News+Room",
										"http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/base/jquery-ui.css" %>
<%= javascript_include_tag :defaults, "http://connect.facebook.net/en_US/all.js", 																										
										"http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js",
										"http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js" %>


<!--This is for displaying on iOS -->
<meta name="viewport" content="width=500">
<meta name="apple-mobile-web-app-capable" content="yes" />
<link rel="apple-touch-icon-precomposed" href="../images/appleLogo.jpg" />

<!--<script type="text/javascript" src="<?php echo $this->config->system_url(); ?>assets/js/bookmark_bubble.js"></script>
<script type="text/javascript" src="<?php echo $this->config->system_url(); ?>assets/js/bubble_example.js"></script>-->

</head>
<body onload="setTimeout(function() { window.scrollTo(0, 1) }, 500); $('#dialog').dialog({ autoOpen:false, modal:true, close:function( ev, ui ){ dialogCloseFunc( ev, ui ); } });" >
<div id="fb-root"></div>
	<!--facebook connect-->
	<script>
	  window.fbAsyncInit = function() {
    	FB.init({appId: '213050112074083', status: true, cookie: true,
	             xfbml: true});
	  };
	  (function() {
	    var e = document.createElement('script'); e.async = true;
    	e.src = document.location.protocol +
	      '//connect.facebook.net/en_US/all.js';
    	document.getElementById('fb-root').appendChild(e);
	  }());
	</script>
	<script>
		function dialogCloseFunc( ev, ui )
		{
			$.post( "<%= url_for( :controller => 'opinions', :only_path => false ) %>", 
				{ 'opinion[user_id]': 6, 'opinion[restaurant_id]': <%= @restaurant.id %>,
					'opinion[foodie]': true, 'opinion[like]': 1 }
				);
		}
	</script>

	<!--
	<div class="backgroundImageWrap">
		<img src="../images/bar.jpg" class="backgroundImage" width="1264" height="790">
	</div>
	-->
	<div id="restaurantContent">
		<div id="header">
			foodierecs
		</div>
		
		<div id="restaurantInfo">
			<div id="restaurantName">
				<%= @restaurant.name %>
			</div>
			
			<div id="restaurantAddress">
				<%= @restaurant.address %>
			</div>
		</div>
		
		<div class="restaurantRecommend">
			<fb:like href="http://metaphoricallydelicious.com" send="false" layout="button_count" width="50" show_faces="true" font="verdana" style="float:left"></fb:like>
			<a href=""><img src="../images/not-for-foodies.jpg" /></a>
		</div>
		
		<div id="dialog" title="Recommendations" style="display:none" >
			<% @opinion = Opinion.new %>
			<%= render :partial => 'opinions/form' %>
		</div>
	
		<script>
			FB.Event.subscribe('edge.create', function(response) {
				/*$.post( "<%= url_for( :controller => 'opinions', :only_path => false ) %>", 
					{ 'opinion[user_id]': 6, 'opinion[restaurant_id]': <%= @restaurant.id %>,
						'opinion[foodie]': true, 'opinion[like]': 1 }
					); */
					
				//REPLACE ABOVE WITH DATA FROM SESSION: USER_ID, FOODIE
				
				//MAKE THE DIALOG OPEN THIS OPINION
				//alert("Hello World! Like created!");
				//$dialog.dialog('open');
				$("#dialog").dialog('open');
  			});
		</script>
		
		<div class="foodieList">
			<b><%= "Foodies who like " + @restaurant.name %>:</b> <br/>
			<% @foodie = true %>
			<% unless @restaurant.opinions.empty? %>
				<table class="opinions" summary="User opinions">
					<%= render @opinions %>
				</table>
				<%= will_paginate @opinions %>
			<% end %>
		</div>
		
		<div class="likeFacePile">
			<b><%= "Everyone who likes " + @restaurant.name %>:</b> <br />
			<div id="fb-root"></div><script src="http://connect.facebook.net/en_US/all.js#xfbml=1"></script><fb:facepile href="<%= request.url; %>" width="200" max_rows="5"></fb:facepile>
		</div>
		
		<div class="commentsWrapper">
		<div class="restaurantComments">
			<div id="fb-root"></div>
			<script src="http://connect.facebook.net/en_US/all.js#xfbml=1"></script>
			<!--Replace the URL for this page and width here-->
			<div id="fb-root"></div><script src="http://connect.facebook.net/en_US/all.js#xfbml=1"></script><fb:comments href="<%= request.url; %>" num_posts="5" width="500"></fb:comments>
		</div>
		</div>
		
	</div>

</body>
</html>